<!DOCTYPE html>
<html lang="vi">
    <head>
        <title>Profile</title>
    </head>
    <body>
        <h1>Profile Sinh Vi√™n</h1>
        <div id="profile"></div>
        <p id="message"></p>
        <button onclick="logout()">ƒêƒÉng xu·∫•t</button>
        <script>
            const Tai_Khoan = window.location.pathname.split('/')[1];
            const token = localStorage.getItem("token");
            console.log("Token: ", token);
            if (!token || !Tai_Khoan) {
                document.getElementById("message").innerText = "Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!";
                setTimeout(() => window.location.href = "/", 2000);
            } else {
                fetchStudentProfile(token, Tai_Khoan);
            }

            async function fetchStudentProfile(token, Tai_Khoan) {
                try {
                    console.log("üéØ Token trong localStorage:", localStorage.getItem("token"));
                    let response = await fetch(`http://localhost:3000/profile/${Tai_Khoan}`, {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${token}`
                        }
                    });

                    let data = await response.json();
                    if (response.ok) {
                        document.getElementById("profile").innerHTML = `
                            <p><strong>M√£ Sinh Vi√™n:</strong> ${data.Ma_Sinh_Vien}</p>
                            <p><strong>H·ªç t√™n:</strong> ${data.Ho_Ten || "Ch∆∞a c·∫≠p nh·∫≠t"}</p>
                            <!-- Th√™m c√°c tr∆∞·ªùng kh√°c n·∫øu c·∫ßn -->
                        `;
                    } else {
                        document.getElementById("message").innerText = data.message;
                    }
                } catch (error) {
                    document.getElementById("message").innerText = "L·ªói t·∫£i profile!";
                }
            }

            function logout() {
                localStorage.clear();
                window.location.href = "/login";
            }
        </script>
    </body>
</html>