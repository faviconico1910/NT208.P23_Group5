<!DOCTYPE html>
<html lang="vi">
    <head>
        <title>Profile</title>
        <link rel="stylesheet" href="/layout/sidebar.css">
        <!-- d√πng chung v·ªõi profile -->
        <link rel="stylesheet" href="../profile.css"> 
    </head>
    <body>
        <div id="sidebar-container"></div>
        <!-- main -->
        <div class="header"></div>
        <div class="profile__container">
            <div class="avatar__container">
                <img src="/image/cat_meme.jpg" alt="avatar">
                <p class="name" id="name"></p>
                <p class="email1" id="email1"></p>
            </div>

            <div class="uni-info-container">
                <div class="uni-info">
                    <div class="uni-info-item uni-info__mgv">
                        <label for="">MGV</label>
                        <p class="mgv" id="mgv"></p>
                    </div>
                    <div class="uni-info-item uni-info__faculty">
                        <label for="">Khoa</label>
                        <p class="faculty" id="faculty"></p>
                    </div>
                    <div class="uni-info-item uni-info__hh">
                        <label for="">H·ªçc h√†m</label>
                        <p class="hh" id="hh"></p>
                    </div>
                    <div class="uni-info-item uni-info__factor">
                        <label for="">H·ªá s·ªë</label>
                        <p class="factor" id="factor"></p>
                    </div>
                    <div class="uni-info-item uni-info__salary">
                        <label for="">M·ª©c L∆∞∆°ng</label>
                        <p class="salary" id="salary"></p>
                    </div>
                </div>
            </div>
            <h2>Th√¥ng tin c√° nh√¢n</h2>
            <div class="personal-info-container">
                
                <div class="personal-info">
                    <div class="personal-info-item personal-info-birth">
                        <label for="">Ng√†y sinh</label>
                        <p class="birth" id="birth"></p>
                    </div>
                    <div class="personal-info-item personal-info-cccd">
                        <label for="">CCCD</label>
                        <p class="cccd" id="cccd"></p>
                    </div>
                    <div class="personal-info-item personal-info-gender">
                        <label for="">Gi·ªõi t√≠nh</label>
                        <p class="gender" id="gender"></p>
                    </div>
                    <div class="personal-info-item personal-info-religion">
                        <label for="">T√¥n gi√°o</label>
                        <p class="religion" id="religion"></p>
                    </div>
                    <div class="personal-info-item personal-info-location">
                        <label for="">Th∆∞·ªùng Tr√∫</label>
                        <p class="location" id="location"></p>
                    </div>
                    <div class="personal-info-item personal-info-email2">
                        <label for="">Email C√° Nh√¢n</label>
                        <p class="email2" id="email2"></p>
                    </div>
                </div>
            </div>
            <div class="info-father-container">
                <div class="info-father">
                    <div class="personal-info-item personal-info-father">
                        <label for="">H·ªç t√™n cha</label>
                        <p class="father" id="father"></p>
                    </div>
                    <div class="personal-info-item personal-info-father_phonenumber">
                        <label for="">S·ªë ƒëi·ªán tho·∫°i</label>
                        <p class="father_phonenumber" id="father_phonenumber"></p>
                    </div>
                    <div class="personal-info-item personal-info-father_job">
                        <label for="">Ngh·ªÅ Nghi·ªáp</label>
                        <p class="father_job" id="father_job"></p>
                    </div>
                </div>
            </div>
            <div class="info-mother-container">
                <div class="info-mother">
                    <div class="personal-info-item personal-info-mother">
                        <label for="">H·ªç t√™n cha</label>
                        <p class="mother" id="mother"></p>
                    </div>
                    <div class="personal-info-item personal-info-mother_phonenumber">
                        <label for="">S·ªë ƒêi·ªán Tho·∫°i</label>
                        <p class="mother_phonenumber" id="mother_phonenumber"></p>
                    </div>
                    <div class="personal-info-item personal-info-mother_job">
                        <label for="">Ngh·ªÅ Nghi·ªáp</label>
                        <p class="mother_job" id="mother_job"></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- javascript here -->
        <script>
            const Tai_Khoan = window.location.pathname.split('/')[2];
            console.log("Gi√° tr·ªã Tai_Khoan:", Tai_Khoan);
            let token = localStorage.getItem("token");

            if (!token || !Tai_Khoan) {
                document.getElementById("message").innerText = "Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i!";
                setTimeout(() => window.location.href = "/login", 2000);
            } else {
                fetchStudentProfile(token, Tai_Khoan);
            }
            
            async function fetchStudentProfile(token, Tai_Khoan) {
                try {
                    console.log("üéØ Token trong localStorage:", localStorage.getItem("token"));
                    let response = await fetch(`http://localhost:3000/teacher/api`, {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": `Bearer ${token}`
                        },
                    });
            
                    let data = await response.json();
                    if (response.ok) {
                        updateProfile(data);
                    } else {
                        document.getElementById("message").textContent = data.message;
                    }
                } catch (error) {
                    document.getElementById("message").textContent = "L·ªói t·∫£i profile!";
                }
            }
            function updateProfile(data) {
                document.getElementById("name").innerText = data.Ho_Ten || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("mgv").innerText = data.Ma_Giang_Vien || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("faculty").innerText = data.Ma_Khoa|| "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("gender").innerText = data.Gioi_Tinh || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("birth").innerText = data.Ngay_Sinh || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("email1").innerText = data.Email_Truong || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("email2").innerText = data.Email_Ca_Nhan || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("cccd").innerText = data.So_CMND || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("religion").innerText = data.Ton_Giao|| "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("location").innerText = data.Thuong_Tru|| "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("hh").innerText = data.Hoc_Ham|| "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("factor").innerText = data.He_So || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("salary").innerText = data.Muc_Luong || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                // father
                document.getElementById("father").innerText = data.Ho_Ten_Cha || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("father_phonenumber").innerText = data.SDT_Cha || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("father_job").innerText = data.Nghe_Nghiep_Cha || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                // mother
                document.getElementById("mother").innerText = data.Ho_Ten_Me || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("mother_phonenumber").innerText = data.SDT_Me || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                document.getElementById("mother_job").innerText = data.Nghe_Nghiep_Me || "Kh√¥ng c√≥ d·ªØ li·ªáu";
            }

            function logout() {
                localStorage.clear();
                localStorage.removeItem("token");
                localStorage.removeItem("Vai_Tro");
                localStorage.removeItem("Tai_Khoan");
                window.location.href = "/login";
            }
            
            // fetch sidebar, ƒëo·∫°n n√†y nha m·∫•y c∆∞ng ∆°i, ph·∫£i c√≥ ·ªü trong m·ªói page
            fetch('/layout/sidebar.html').then(response => response.text())
            .then(html => {
                document.getElementById("sidebar-container").innerHTML = html;
                const toggleButton = document.getElementById("toggle-btn");
                const sidebar = document.getElementById("sidebar");

                toggleButton.addEventListener("click", () => {
                    sidebar.classList.toggle("collapsed");
                })
            });
        </script>
    </body>
</html>